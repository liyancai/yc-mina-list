<i-message id="message" />

<!--  -->
<view class="project-view {{project.cover ? '' : 'default'}}" style="background: url('{{project.cover}}') {{project.color}} no-repeat; background-size: cover;">
  <view class="project-info">
    <image src="{{project.avatar}}" lazy-load="{{true}}"></image>
    <i-icon wx:if="{{isMember}}" type="setup" size="24" bindtap="showProjectOptModal"/>
  </view>
  <view class="project-info">
      <text>{{project.name || ''}}</text>
  </view>
</view>
<!--  -->
<view class="member-view">
  <view wx:for="{{project.members}}" wx:key="member_{{index}}">
    <image src="{{memberMap[item].avatar}}" lazy-load="{{true}}"></image>
  </view>
  <view wx:if="{{project.members.length < project.max_num_account && isMember}}">
    <button open-type="share"><i-icon type="add" size="40" color="{{project.color}}" /></button>
  </view>
</view>

<!--  -->
<view class="label">待办事项</view>

<view wx:if="{{isMember}}" class="task-item todo-task-item">
  <i-icon type="add" size="28" />
  <input value="{{inputValue}}" placeholder="添加新的待办事项" maxlength="200" bindconfirm="addTask"></input>
</view>

<block wx:for="{{todoTaskList}}" wx:key='todo_task_{{index}}'>
  <view wx:if="{{isMember}}" class="task-item todo-task-item">
    <i-icon type="offline" size="28" bindtap="doneTask" data-task-id="{{item._id}}" data-index="{{index}}"/>
    <view class="task-item-title" bindlongpress="showTaskOptModal" data-task="{{item}}" data-index="{{index}}">{{item.title}}</view>
    <image wx:if="{{project.max_num_account != 1}}" src="{{memberMap[item.author].avatar}}" lazy-load="{{true}}"></image>
  </view>

  <view wx:else class="task-item todo-task-item">
    <i-icon type="play" size="28"/>
    <view class="task-item-title">{{item.title}}</view>
    <image wx:if="{{project.max_num_account != 1}}" src="{{memberMap[item.author].avatar}}" lazy-load="{{true}}"></image>
  </view>
</block>

<!--  -->
<view class="label" wx:if="{{doneTaskList}}">已完成</view>

<block wx:for="{{doneTaskList}}" wx:key='done_task_{{index}}'>
  <view wx:if="{{isMember}}" class="task-item done-task-item">
    <i-icon type="success_fill" size="28" bindtap="undoneTask" data-task-id="{{item._id}}" data-index="{{index}}"/>
    <view class="task-item-title" bindlongpress="showTaskOptModal" data-task="{{item}}" data-index="{{index}}">{{item.title}}</view>
    <image wx:if="{{project.max_num_account != 1}}" src="{{memberMap[item.completer].avatar}}" lazy-load="{{true}}"></image>
  </view>

  <view wx:else class="task-item done-task-item">
    <i-icon type="success" size="28"/>
    <view class="task-item-title">{{item.title}}</view>
    <image wx:if="{{project.max_num_account != 1}}" src="{{memberMap[item.completer].avatar}}" lazy-load="{{true}}"></image>
  </view>
</block>

<view class="line-m"></view>

<!-- 海报 -->
<view class="canvas-view {{placardVisible ? 'active' : ''}}" bindtap="closeCanvasView">
  <view class="mask"></view>
  <view class="main">
    <canvas canvas-id="project-placard"></canvas>
    <view class="opt-view">
      <view class="download-btn" catchtap="save2PhoneImage">下载到手机</view>
      <view class="download-btn" catchtap="previewImage">长按分享</view>
    </view>
  </view>
</view>
